<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IA Jogo da Velha — Kids</title>
  <style>
    :root{
      --bg:#0f1117;
      --panel:#151923;
      --fg:#e6e8ef;
      --muted:#a0a8b8;
      --primary:#8b5cf6;   /* roxo */
      --accent:#22d3ee;    /* ciano */
      --win:#10b981;       /* verde */
      --x:#f59e0b;         /* âmbar */
      --o:#60a5fa;         /* azul */
      --border:#232a36;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 10% -20%, #141826 0%, transparent 60%) no-repeat,
                  radial-gradient(900px 700px at 110% 20%, #101525 0%, transparent 55%) no-repeat,
                  var(--bg);
      color:var(--fg);
      font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }

    .app{
      width:min(92vw, 560px);
      display:flex; flex-direction:column; align-items:center; gap:16px;
    }

    .card{
      width:100%;
      background:linear-gradient(180deg, #151a24, #121620);
      border:1px solid var(--border);
      border-radius:14px;
      padding:18px;
      box-shadow:var(--shadow);
    }

    h1{
      margin:0 0 6px 0;
      font-size:clamp(22px, 3vw, 28px);
      font-weight:700;
      letter-spacing:.2px;
      display:flex; align-items:center; gap:.5rem;
    }
    .sub{
      margin:0 0 10px 0;
      color:var(--muted);
      font-size:.95rem;
    }

    .status{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin:10px 0 14px 0;
    }
    .badge{
      display:inline-flex; align-items:center; gap:.4rem;
      background:#101521;
      border:1px solid var(--border);
      color:var(--muted);
      padding:.45rem .7rem;
      border-radius:999px;
      font-size:.92rem;
    }
    .dot{width:.55rem; height:.55rem; border-radius:50%}
    .dot.x{background:var(--x)}
    .dot.o{background:var(--o)}

    .scores{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .chip{
      background:#0f1523;
      border:1px solid var(--border);
      border-radius:10px;
      padding:.4rem .65rem;
      color:var(--muted);
      font-size:.9rem;
    }

    .board{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      width:100%;
      margin:6px 0 10px 0;
    }
    .square{
      aspect-ratio:1/1;
      border-radius:12px;
      border:1px solid var(--border);
      background:linear-gradient(180deg, #151a22, #121620);
      display:flex; align-items:center; justify-content:center;
      font-weight:800;
      font-size:clamp(32px, 8vw, 56px);
      letter-spacing:1px;
      color:#cfd7ff;
      cursor:pointer;
      user-select:none;
      transition:transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      box-shadow: inset 0 0 0 0 rgba(255,255,255,0);
    }
    .square:hover{ transform:translateY(-1px); }
    .square:active{ transform:translateY(0); }
    .square.disabled{ cursor:default; opacity:.9; }
    .square.x{ color:var(--x); text-shadow:0 0 18px rgba(245,158,11,.2); }
    .square.o{ color:var(--o); text-shadow:0 0 18px rgba(96,165,250,.25); }
    .square.win{
      background:linear-gradient(180deg, rgba(16,185,129,.14), rgba(16,185,129,.06));
      border-color:rgba(16,185,129,.4);
      box-shadow: inset 0 0 0 1px rgba(16,185,129,.35), 0 8px 30px rgba(16,185,129,.15);
    }

    .controls{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      margin-top:6px;
    }
    button.btn{
      background:linear-gradient(180deg, #1c2230, #161b27);
      border:1px solid var(--border);
      color:var(--fg);
      padding:.65rem 1rem;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
      transition:filter .15s ease, transform .06s ease, border-color .2s ease;
    }
    button.btn:hover{ filter:brightness(1.08); border-color:#2b3343; }
    button.btn:active{ transform:translateY(1px); }
    .btn.primary{
      background:linear-gradient(180deg, rgba(139,92,246,.22), rgba(139,92,246,.14));
      border-color:rgba(139,92,246,.5);
      color:#e9e5ff;
    }
    .announce{
      text-align:center; font-size:1.05rem; font-weight:600;
      padding:.6rem .8rem; border-radius:10px; margin:8px 0 0;
      background:linear-gradient(180deg, #121826, #0f1421);
      border:1px solid var(--border);
    }
    .announce.win-x{ color:var(--x); box-shadow:inset 0 0 0 1px rgba(245,158,11,.25); }
    .announce.win-o{ color:var(--o); box-shadow:inset 0 0 0 1px rgba(96,165,250,.25); }
    .announce.draw{ color:var(--muted); }

    .credit{
      margin-top:12px;
      font-size:.85rem;
      color:var(--muted);
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>IA - Jogo da Velha <span style="font-size:1.2rem;color:var(--primary)">• Kids</span></h1>
      <p class="sub">Jogue contra o computador: você é X, a IA é O.</p>

      <div class="status">
        <div class="badge" id="turnBadge" aria-live="polite">
          <span class="dot x" id="dot"></span>
          <span id="turnText">Vez de X</span>
        </div>
        <div class="scores" aria-label="Placar">
          <div class="chip">X: <strong id="scoreX">0</strong></div>
          <div class="chip">O: <strong id="scoreO">0</strong></div>
          <div class="chip">Empates: <strong id="scoreD">0</strong></div>
        </div>
      </div>

      <div class="board" id="board" role="grid" aria-label="Tabuleiro do jogo da velha">
        <button class="square" role="gridcell" aria-label="casa 1" data-idx="0"></button>
        <button class="square" role="gridcell" aria-label="casa 2" data-idx="1"></button>
        <button class="square" role="gridcell" aria-label="casa 3" data-idx="2"></button>
        <button class="square" role="gridcell" aria-label="casa 4" data-idx="3"></button>
        <button class="square" role="gridcell" aria-label="casa 5" data-idx="4"></button>
        <button class="square" role="gridcell" aria-label="casa 6" data-idx="5"></button>
        <button class="square" role="gridcell" aria-label="casa 7" data-idx="6"></button>
        <button class="square" role="gridcell" aria-label="casa 8" data-idx="7"></button>
        <button class="square" role="gridcell" aria-label="casa 9" data-idx="8"></button>
      </div>

      <div id="announce" class="announce" style="display:none;"></div>

      <div class="controls">
        <button class="btn primary" id="btnNovo">Nova rodada</button>
        <button class="btn" id="btnZerar">Zerar placar</button>
      </div>

      <div class="credit">Powered by Michel Breno</div>
    </div>
  </div>

  <script>
    (function(){
      const boardEl = document.getElementById('board');
      const cells = Array.from(boardEl.querySelectorAll('.square'));
      const turnText = document.getElementById('turnText');
      const dot = document.getElementById('dot');
      const announce = document.getElementById('announce');
      const btnNovo = document.getElementById('btnNovo');
      const btnZerar = document.getElementById('btnZerar');
      const scoreXEl = document.getElementById('scoreX');
      const scoreOEl = document.getElementById('scoreO');
      const scoreDEl = document.getElementById('scoreD');

      // Sons offline (Web Audio)
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const audioCtx = new AudioCtx();
      const unlock = () => {
        if (audioCtx.state !== 'running') audioCtx.resume();
        window.removeEventListener('pointerdown', unlock);
        window.removeEventListener('keydown', unlock);
      };
      window.addEventListener('pointerdown', unlock, { once: true });
      window.addEventListener('keydown', unlock, { once: true });

      function tone({ freq=600, duration=0.08, type='square', volume=0.22, start=audioCtx.currentTime }){
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, start);
        gain.gain.setValueAtTime(0.0001, start);
        gain.gain.exponentialRampToValueAtTime(volume, start + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, start + duration);
        osc.connect(gain).connect(audioCtx.destination);
        osc.start(start);
        osc.stop(start + duration + 0.02);
      }
      const sClick = { play(){ const t=audioCtx.currentTime; tone({freq:520,duration:0.07,type:'square',volume:0.18,start:t}); tone({freq:260,duration:0.06,type:'square',volume:0.12,start:t}); } };
      const sWin   = { play(){ const t=audioCtx.currentTime+0.02; tone({freq:740,duration:0.12,type:'sine',volume:0.22,start:t}); tone({freq:880,duration:0.12,type:'sine',volume:0.22,start:t+0.12}); tone({freq:988,duration:0.16,type:'sine',volume:0.22,start:t+0.24}); } };

      const WINS = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];

      const HUMAN='X', CPU='O';
      const state = { board:Array(9).fill(null), current:HUMAN, running:true, scores:{X:0,O:0,D:0} };

      function setTurnUI(){
        turnText.textContent = `Vez de ${state.current}`;
        dot.className = 'dot ' + (state.current === 'X' ? 'x' : 'o');
      }
      function renderCell(i){
        const val = state.board[i];
        const el = cells[i];
        el.textContent = val || '';
        el.classList.toggle('x', val === 'X');
        el.classList.toggle('o', val === 'O');
        el.classList.toggle('disabled', !!val || !state.running);
        el.setAttribute('aria-label', `casa ${i+1}${val ? ' contém ' + val : ''}`);
      }
      function renderBoard(){ for (let i=0;i<9;i++) renderCell(i); }
      function clearHighlights(){
        cells.forEach(c => c.classList.remove('win'));
        announce.style.display = 'none';
        announce.className = 'announce';
        announce.textContent = '';
      }
      function checkWinner(){
        for (const [a,b,c] of WINS){
          const v = state.board[a];
          if (v && v === state.board[b] && v === state.board[c]) return { winner:v, combo:[a,b,c] };
        }
        if (state.board.every(Boolean)) return { winner:null, combo:null, draw:true };
        return null;
      }
      function endRound(res){
        state.running=false;
        cells.forEach(c=>c.classList.add('disabled'));
        if (res.draw){
          state.scores.D++; scoreDEl.textContent = state.scores.D;
          announce.textContent = 'Empate!'; announce.classList.add('draw');
        } else {
          const w = res.winner;
          (w==='X' ? state.scores.X++ : state.scores.O++);
          scoreXEl.textContent = state.scores.X;
          scoreOEl.textContent = state.scores.O;
          res.combo.forEach(i => cells[i].classList.add('win'));
          announce.textContent = `${w} venceu!`;
          announce.classList.add(w==='X' ? 'win-x' : 'win-o');
          try { sWin.play(); } catch(e) {}
        }
        announce.style.display = 'block';
      }

      // IA — minimax + aleatoriedade controlada
      const winnerOf = (b) => {
        for (const [a,b2,c] of WINS){ if (b[a] && b[a]===b[b2] && b[a]===b[c]) return b[a]; }
        return null;
      };
      const emptySpots = (b) => { const r=[]; for (let i=0;i<9;i++) if (!b[i]) r.push(i); return r; };

      function minimax(b, current, depth){
        const w = winnerOf(b);
        if (w===CPU) return { score: 10 - depth };
        if (w===HUMAN) return { score: depth - 10 };
        const empties = emptySpots(b);
        if (!empties.length) return { score: 0 };
        let bestScore = (current===CPU ? -Infinity : Infinity), bestIdx = null;
        for (const idx of empties){
          b[idx] = current;
          const { score } = minimax(b, current===CPU ? HUMAN : CPU, depth+1);
          b[idx] = null;
          if (current===CPU ? (score>bestScore) : (score<bestScore)){
            bestScore = score; bestIdx = idx;
          }
        }
        return { score: bestScore, idx: bestIdx };
      }

      const dificuldadeErro = 0.60; // 60% das vezes a IA fará um movimento não ótimo

      function bestMove(){
        const b = state.board.slice();
        const empties = emptySpots(b);

        // vitória imediata
        for (const i of empties){ b[i]=CPU; if (winnerOf(b)===CPU) return i; b[i]=null; }
        // bloqueio imediato
        for (const i of empties){ b[i]=HUMAN; if (winnerOf(b)===HUMAN) return i; b[i]=null; }

        // fator de aleatoriedade controlada (só quando não há urgência)
        if (empties.length && Math.random() < dificuldadeErro){
          return empties[Math.floor(Math.random() * empties.length)];
        }

        // centro preferencial
        if (b[4]==null) return 4;

        // minimax como fallback
        const { idx } = minimax(b, CPU, 0);
        return idx ?? empties[0];
      }

      // Fluxo
      function humanPlay(i){
        if (!state.running || state.board[i] || state.current!==HUMAN) return;
        state.board[i] = HUMAN;
        renderCell(i);
        try { sClick.play(); } catch(e) {}
        const res = checkWinner();
        if (res){ endRound(res); return; }
        state.current = CPU; setTurnUI();
        setTimeout(aiPlay, 220);
      }
      function aiPlay(){
        if (!state.running || state.current!==CPU) return;
        const m = bestMove();
        if (m != null){
          state.board[m] = CPU;
          renderCell(m);
          try { sClick.play(); } catch(e) {}
        }
        const res = checkWinner();
        if (res){ endRound(res); return; }
        state.current = HUMAN; setTurnUI();
      }

      function newRound(){
        state.board.fill(null);
        state.current = HUMAN;
        state.running = true;
        clearHighlights();
        setTurnUI();
        renderBoard();
      }
      function resetScores(){
        state.scores = { X:0, O:0, D:0 };
        scoreXEl.textContent = '0';
        scoreOEl.textContent = '0';
        scoreDEl.textContent = '0';
        newRound();
      }

      // Eventos
      boardEl.addEventListener('click', (e)=>{
        const cell = e.target.closest('.square');
        if (!cell) return;
        if (state.current !== HUMAN) return;
        const idx = Number(cell.dataset.idx);
        humanPlay(idx);
      });
      boardEl.addEventListener('keydown', (e)=>{
        const cell = e.target.closest('.square');
        if (!cell) return;
        if ((e.key==='Enter' || e.key===' ') && state.running && state.current===HUMAN){
          e.preventDefault();
          humanPlay(Number(cell.dataset.idx));
        }
      });
      btnNovo.addEventListener('click', newRound);
      btnZerar.addEventListener('click', resetScores);

      // Inicialização
      newRound();
      cells.forEach(c => c.setAttribute('tabindex','0'));
    })();
  </script>
  <script>
    (function () {
      var NAMESPACE = 'meu-portfolio';
    var KEY = location.pathname; // usa o caminho da URL como identificador
    
      function render(n) {
        var id = 'visit-counter-badge';
        var el = document.getElementById(id);
        if (!el) {
          el = document.createElement('div');
          el.id = id;
          el.style.cssText = 'position:fixed;bottom:12px;right:12px;background:rgba(0,0,0,0.4);color:#fff;padding:6px 10px;border-radius:999px;font:12px/1.2 system-ui,Arial,sans-serif;backdrop-filter:blur(4px);box-shadow:0 2px 8px rgba(0,0,0,.15);z-index:2147483647';
          document.body.appendChild(el);
        }
        el.textContent = 'Visitas: ' + n;
      }
    
      var url = 'https://api.countapi.xyz/hit/' +
                encodeURIComponent(NAMESPACE) + '/' +
                encodeURIComponent(KEY);
    
      fetch(url).then(r => r.json()).then(d => {
        render(d && typeof d.value === 'number' ? d.value : 0);
      }).catch(() => {
        var k = 'vc_' + NAMESPACE + '_' + KEY;
        var n = +(localStorage.getItem(k) || 0) + 1;
        localStorage.setItem(k, n);
        render(n);
      });
    })();
    </script>
    
</body>
</html>
