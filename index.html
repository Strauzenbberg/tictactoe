<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jogo da Velha — Dark</title>
  <style>
    /* ... (estilos originais mantidos) ... */
  </style>
</head>
<body>
  <div class="app">
    <!-- ... (HTML original mantido) ... -->
  </div>

  <script>
    (function(){
      const boardEl = document.getElementById('board');
      const cells = Array.from(boardEl.querySelectorAll('.square'));
      const turnText = document.getElementById('turnText');
      const dot = document.getElementById('dot');
      const announce = document.getElementById('announce');
      const btnNovo = document.getElementById('btnNovo');
      const btnZerar = document.getElementById('btnZerar');
      const scoreXEl = document.getElementById('scoreX');
      const scoreOEl = document.getElementById('scoreO');
      const scoreDEl = document.getElementById('scoreD');

      const WINS = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
      ];

      const state = {
        board: Array(9).fill(null),
        current: 'X',
        running: true,
        scores: { X:0, O:0, D:0 }
      };

      function playBeep(freq = 440, duration = 150, volume = 0.3) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'square';
        osc.frequency.value = freq;
        gain.gain.value = volume;
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + duration / 1000);
      }

      function setTurnUI(){
        turnText.textContent = `Vez de ${state.current}`;
        dot.className = 'dot ' + (state.current === 'X' ? 'x' : 'o');
      }

      function renderCell(i){
        const val = state.board[i];
        const el = cells[i];
        el.textContent = val ? val : '';
        el.classList.toggle('x', val === 'X');
        el.classList.toggle('o', val === 'O');
        el.classList.toggle('disabled', !!val || !state.running);
        el.setAttribute('aria-label', `casa ${i+1}${val ? ' contém ' + val : ''}`);
      }

      function renderBoard(){
        for(let i=0;i<9;i++) renderCell(i);
      }

      function clearHighlights(){
        cells.forEach(c => c.classList.remove('win'));
        announce.style.display = 'none';
        announce.className = 'announce';
        announce.textContent = '';
      }

      function checkWinner(){
        for(const combo of WINS){
          const [a,b,c] = combo;
          const v = state.board[a];
          if (v && v === state.board[b] && v === state.board[c]) {
            return { winner: v, combo };
          }
        }
        if (state.board.every(Boolean)) return { winner: null, combo: null, draw:true };
        return null;
      }

      function endRound(result){
        state.running = false;
        cells.forEach(c => c.classList.add('disabled'));

        if (result.draw) {
          state.scores.D++;
          scoreDEl.textContent = state.scores.D;
          announce.textContent = 'Empate!';
          announce.classList.add('draw');
          playBeep(300); // som de empate
        } else {
          const w = result.winner;
          (w === 'X' ? state.scores.X++ : state.scores.O++);
          scoreXEl.textContent = state.scores.X;
          scoreOEl.textContent = state.scores.O;
          result.combo.forEach(i => cells[i].classList.add('win'));
          announce.textContent = `${w} venceu!`;
          announce.classList.add(w === 'X' ? 'win-x' : 'win-o');
          playBeep(800); // som de vitória
        }
        announce.style.display = 'block';
      }

      function handlePlay(i){
        if (!state.running || state.board[i]) return;
        state.board[i] = state.current;
        renderCell(i);
        playBeep(600); // som de jogada

        const result = checkWinner();
        if (result) {
          endRound(result);
        } else {
          state.current = (state.current === 'X') ? 'O' : 'X';
          setTurnUI();
        }
      }

      function newRound(){
        state.board.fill(null);
        state.current = 'X';
        state.running = true;
        clearHighlights();
        setTurnUI();
        renderBoard();
        playBeep(500); // som de nova rodada
      }

      function resetScores(){
        state.scores = { X:0, O:0, D:0 };
        scoreXEl.textContent = '0';
        scoreOEl.textContent = '0';
        scoreDEl.textContent = '0';
        newRound();
        playBeep(400); // som de reset
      }

      boardEl.addEventListener('click', (e)=>{
        const cell = e.target.closest('.square');
        if (!cell) return;
        const idx = Number(cell.dataset.idx);
        handlePlay(idx);
      });

      boardEl.addEventListener('keydown', (e)=>{
        const cell = e.target.closest('.square');
        if (!cell) return;
        if ((e.key === 'Enter' || e.key === ' ') && state.running) {
          e.preventDefault();
          handlePlay(Number(cell.dataset.idx));
        }
      });

      btnNovo.addEventListener('click', newRound);
      btnZerar.addEventListener('click', resetScores);

      newRound();
      cells.forEach(c => c.setAttribute('tabindex','0'));
    })();
  </script>
</body>
</html>
